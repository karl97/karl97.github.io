<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WebGPU Example</title>
    <style>
        body, html {
            margin: 0;
            height: 100%;
            overflow: hidden;
        }
        canvas {
            width: 100%;
            height: 100%;
            display: block;
        }
    </style>
</head>
<body>
    <canvas id="gpuCanvas"></canvas>
    <script type="module">
        async function initWebGPU() {
            if (!navigator.gpu) {
                console.error('WebGPU is not supported by this browser.');
                return;
            }

            const adapter = await navigator.gpu.requestAdapter();
            const device = await adapter.requestDevice();
            const canvas = document.getElementById('gpuCanvas');
            const context = canvas.getContext('webgpu');
            const canvasFormat = navigator.gpu.getPreferredCanvasFormat();

            context.configure({
                device: device,
                format: canvasFormat,
                alphaMode: 'opaque'
            });

            let time = 0.0;

            function frame() {
                time += 0.01;
                const color = {
                    r: (Math.sin(time) + 1) / 2,
                    g: (Math.cos(time) + 1) / 2,
                    b: (Math.sin(time + Math.PI / 2) + 1) / 2,
                    a: 1.0
                };

                const renderPassDescriptor = {
                    colorAttachments: [
                        {
                            view: context.getCurrentTexture().createView(),
                            loadOp: 'clear',
                            clearValue: color,
                            storeOp: 'store'
                        }
                    ]
                };

                const commandEncoder = device.createCommandEncoder();
                const passEncoder = commandEncoder.beginRenderPass(renderPassDescriptor);
                passEncoder.endPass();

                const commandBuffer = commandEncoder.finish();
                device.queue.submit([commandBuffer]);

                requestAnimationFrame(frame);
            }

            requestAnimationFrame(frame);
        }

        window.addEventListener('load', initWebGPU);
    </script>
</body>
</html>
